<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productivity App Configuration</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Workify</h1>
            <p>Configure your focus session settings</p>
        </div>
        <!-- Tab Navigation -->
        <div style="background: #f1f3f6; border-bottom: 1px solid #e9ecef; display: flex;">
            <button class="tab-btn" id="configTabBtn" onclick="showTab('config')">Configuration</button>
            <button class="tab-btn" id="diaryTabBtn" onclick="showTab('diary')">Diary Entries</button>
        </div>
        <div class="content">
            {% if message %}
                <div class="alert alert-{{ message_type }}">
                    {{ message }}
                </div>
            {% endif %}
            <!-- Configuration Tab -->
            <div id="configTab" class="tab-content">
                <form method="POST" action="/update-config" class="config-form">
                    <!-- Timer Settings -->
                    <div class="section">
                        <h2 class="section-title">‚è±Ô∏è Timer Settings</h2>
                        <div class="form-group">
                            <label for="default_duration_minutes">Default Session Duration (minutes)</label>
                            <div>
                                <input type="number" id="default_duration_minutes" name="default_duration_minutes" 
                                       value="{{ config.default_duration_minutes }}" min="1" max="120" required>
                                <div class="description">How long should a standard focus session last?</div>
                            </div>
                        </div>
                    </div>
                    <!-- AI Detection Settings -->
                    <div class="section">
                        <h2 class="section-title">ü§ñ AI Detection Settings</h2>
                        <div class="form-group">
                            <label for="confidence_threshold">Confidence Threshold</label>
                            <div>
                                <input type="number" id="confidence_threshold" name="confidence_threshold" 
                                       value="{{ config.confidence_threshold }}" min="0.1" max="1.0" step="0.05" required>
                                <div class="description">Minimum confidence for person detection (0.1 - 1.0)</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="nms_confidence_threshold">NMS Confidence Threshold</label>
                            <div>
                                <input type="number" id="nms_confidence_threshold" name="nms_confidence_threshold" 
                                       value="{{ config.nms_confidence_threshold }}" min="0.1" max="1.0" step="0.05" required>
                                <div class="description">Non-maximum suppression confidence threshold</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="nms_iou_threshold">NMS IoU Threshold</label>
                            <div>
                                <input type="number" id="nms_iou_threshold" name="nms_iou_threshold" 
                                       value="{{ config.nms_iou_threshold }}" min="0.1" max="1.0" step="0.05" required>
                                <div class="description">Non-maximum suppression IoU threshold</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="input_width">Input Width (pixels)</label>
                            <div>
                                <input type="number" id="input_width" name="input_width" 
                                       value="{{ config.input_width }}" min="320" max="1024" step="32" required>
                                <div class="description">YOLO model input width (lower = faster processing)</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="input_height">Input Height (pixels)</label>
                            <div>
                                <input type="number" id="input_height" name="input_height" 
                                       value="{{ config.input_height }}" min="320" max="1024" step="32" required>
                                <div class="description">YOLO model input height (lower = faster processing)</div>
                            </div>
                        </div>
                    </div>
                    <!-- Audio Settings -->
                    <div class="section">
                        <h2 class="section-title">üîä Audio Settings</h2>
                        <div class="form-group">
                            <label for="alarm_sound_file">Alarm Sound File</label>
                            <div>
                                <input type="text" id="alarm_sound_file" name="alarm_sound_file" 
                                       value="{{ config.alarm_sound_file }}" required>
                                <div class="description">Audio file to play during focus sessions</div>
                            </div>
                        </div>
                    </div>
                    <!-- Notification Settings -->
                    <div class="section">
                        <h2 class="section-title">üì± Notification Settings</h2>
                        <div class="form-group">
                            <label for="show_countdown">Show Countdown Timer</label>
                            <div class="checkbox-group">
                                <input type="checkbox" id="show_countdown" name="show_countdown" 
                                       {% if config.show_countdown %}checked{% endif %}>
                                <div class="description">Display countdown notifications during sessions</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="countdown_update_interval">Countdown Update Interval (seconds)</label>
                            <div>
                                <input type="number" id="countdown_update_interval" name="countdown_update_interval" 
                                       value="{{ config.countdown_update_interval }}" min="1" max="300" required>
                                <div class="description">How often to update countdown notifications</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="ask_diary_entry">Ask for Diary Entry</label>
                            <div class="checkbox-group">
                                <input type="checkbox" id="ask_diary_entry" name="ask_diary_entry" 
                                       {% if config.ask_diary_entry %}checked{% endif %}>
                                <div class="description">Prompt for diary entry after focus sessions</div>
                            </div>
                        </div>
                    </div>
                    <div class="btn-container">
                        <button type="submit" class="btn-primary">üíæ Save Configuration</button>
                    </div>
                </form>
            </div>
            <!-- Diary Entries Tab -->
            <div id="diaryTab" class="tab-content" style="display:none;">
                <div class="section" id="diaries">
                    
                </div>
            </div>
        </div>
    </div>
    <script>
        // Tab switching logic
        function showTab(tab) {
            document.getElementById('configTab').style.display = (tab === 'config') ? '' : 'none';
            document.getElementById('diaryTab').style.display = (tab === 'diary') ? '' : 'none';
            document.getElementById('configTabBtn').style.background = (tab === 'config') ? '#fff' : '';
            document.getElementById('diaryTabBtn').style.background = (tab === 'diary') ? '#fff' : '';
        }
        showTab('config');
    </script>
    <script>
    const diaryEntries = {{ diary_entries|tojson }}; //Ignore errors...
    const uniqueDates = [...new Set(diaryEntries.map(entry => entry.date))];
    const diaryEntriesByDate = uniqueDates.map(date => {
        return {
            date: date,
            entries: diaryEntries.filter(entry => entry.date === date)
        };
    });
    console.log(diaryEntriesByDate);
    const diariesContainer = document.getElementById('diaries');
    diaryEntriesByDate.forEach(element => {

        diariesContainer.innerHTML += `
            <h2 class="section-title">${element.date}</h2>
            ${element.entries.length > 0 ? `
                <ul style="list-style:none; padding:0;">
                    ${element.entries.map(entry => `
                        <li style="margin-bottom: 18px; padding: 15px; background: #f8f9fa; border-radius: 10px; border: 1px solid #e9ecef;">
                            <div style="font-size:1.1rem; color:#333; margin-bottom:6px;"><b>${entry.date}</b></div>
                            <div style="color:#555;">${entry.text}</div>
                        </li>
                    `).join('')}
                </ul>
            ` : '<div style="color:#888; font-style:italic;">No diary entries found.</div>'}
        `;
        
    });
</script>
</body>
</html>
